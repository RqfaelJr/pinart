{% extends 'base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="{% static 'css/editar_perfil.css' %}">
<div class="edit-profile-page">
    <div class="edit-card">
        <h2 class="page-title">
            <i class="fa-solid fa-user-pen"></i> Editar Perfil
        </h2>

        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}

            <div class="file-input-wrapper">
                {% if user.pessoa.foto %}
                    <img src="{{ user.pessoa.foto.url }}" class="current-photo" alt="Foto atual">
                {% else %}
                    <div class="current-photo" style="background: #e0e0e0; display: inline-flex; align-items: center; justify-content: center; font-size: 40px; color: white;">
                        <i class="fa-solid fa-user"></i>
                    </div>
                {% endif %}
                
                <div class="form-group" style="margin-bottom: 0;">
                    <label>Alterar Foto</label>
                    {{ p_form.foto }}
                </div>
            </div>

            <div class="section-header">Informações Pessoais</div>

            <div style="display: flex; gap: 15px;">
                <div class="form-group" style="flex: 1;">
                    <label>Nome</label>
                    {{ u_form.first_name }}
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>Sobrenome</label>
                    {{ u_form.last_name }}
                </div>
            </div>

            <div class="form-group">
                <label>E-mail</label>
                {{ u_form.email }}
            </div>

            <div class="section-header">Detalhes de Contato</div>

            <div class="form-group">
                <label>Telefone</label>
                {{ p_form.telefone }}
            </div>
            
            <div class="form-group">
                <label>Endereço</label>
                {{ p_form.endereco }}
            </div>

            <div class="btn-actions">
                <a href="{% url 'perfil' %}" class="btn-cancel">Cancelar</a>
                <button type="submit" class="btn-save">Salvar Alterações</button>
            </div>

        </form>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const wrapper = document.querySelector('.file-input-wrapper');
        const fileInput = wrapper.querySelector('input[type="file"]');
        
        fileInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            
            if (file) {
                const reader = new FileReader();

                reader.onload = function(e) {
                    const currentElement = wrapper.querySelector('.current-photo');

                    if (currentElement.tagName === 'IMG') {
                        currentElement.src = e.target.result;
                    } 
                    
                    else {
                        const newImg = document.createElement('img');
                        newImg.src = e.target.result;
                        newImg.className = 'current-photo';
                        newImg.alt = "Prévia da foto";
                        currentElement.parentNode.replaceChild(newImg, currentElement);
                    }
                }
                reader.readAsDataURL(file);
            }
        });
    });
</script>
{% endblock %}